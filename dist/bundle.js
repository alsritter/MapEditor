(()=>{"use strict";var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{q:()=>y,S:()=>w});var e=function(){function t(){}return t.drawGrid=function(t,e,r,n,i,o){for(var a=0;a<i;a++)t.beginPath(),t.moveTo(e*a-.5,0),t.lineTo(e*a-.5,n),t.setLineDash([1,2]),t.strokeStyle="#2a2a2a",t.stroke();for(a=0;a<o;a++)t.beginPath(),t.moveTo(0,e*a-.5),t.lineTo(r,e*a-.5),t.strokeStyle="#2a2a2a",t.stroke()},t.drawDark=function(t,e,r,n){t.fillStyle="rgba(0, 0, 0, 0.2)",t.beginPath(),t.rect(r,n,e,e),t.fill(),t.closePath()},t.drawColor=function(t,e,r,n,i){t.fillStyle=i,t.beginPath(),t.rect(r,n,e,e),t.fill(),t.closePath()},t.drawTile=function(t,e,r,n,i,o,a){t.drawImage(e.getImage(),e.getTile(r,n).x,e.getTile(r,n).y,e.getWidth(),e.getHeight(),o,a,i,i)},t.drawBackground=function(t,e,r){for(var n=t.createImageData(e,r),i=n.data,o=0;o<r;o++)for(var a=0;a<e;a++){var s=o*e+a<<2,l=(o>>2)+(a>>2)&1?204:255;i[s]=l,i[s+1]=l,i[s+2]=l,i[s+3]=255}t.putImageData(n,0,0)},t.drawMapTile=function(e,r,n,i){for(var o=0;o<n.getRowNum();o++)for(var a=0;a<n.getColNum();a++)null==n.getGrid(o,a).tileX||null==n.getGrid(o,a).tileY||t.isEmpty(r,n.getGrid(o,a).tileX,n.getGrid(o,a).tileY)||t.drawTile(e,r,n.getGrid(o,a).tileX,n.getGrid(o,a).tileY,i,n.getGrid(o,a).x,n.getGrid(o,a).y)},t.isEmpty=function(t,e,r){return t.getTile(e,r).isEmpty},t.drawAllTile=function(e,r,n,i){for(var o=0;o<r.getCols();o++)for(var a=0;a<r.getRows();a++)t.drawTile(e,r,o,a,i,n.getGrid(o,a).x,n.getGrid(o,a).y)},t}(),r=function(t,e,r,n){this.x=t,this.y=e,this.tileX=r,this.tileY=n},n=function(){function t(t,e,n){this.map=new Array,this.cols=e,this.rows=n;for(var i=0;i<n;i++){for(var o=[],a=0;a<e;a++)o.push(new r(a*t,i*t,null,null));this.map.push(o)}}return t.prototype.getGrid=function(t,e){return this.map[t][e]},t.prototype.getColNum=function(){return this.cols},t.prototype.getRowNum=function(){return this.rows},t.prototype.getClone=function(){return JSON.parse(JSON.stringify(this.map))},t.prototype.setMap=function(t){this.map=t},t.prototype.cleanMap=function(){for(var t=0;t<this.map.length;t++)for(var e=0;e<this.map[t].length;e++)this.map[t][e].tileX=null,this.map[t][e].tileY=null},t}(),i=function(t,e,r){this.x=t,this.y=e,this.isEmpty=r},o=function(){function t(t,e,r,n){this.cols=e,this.rows=r,this.img=n,this.tileMap=[],this.sWidth=0,this.sHeight=0,this.sWidth=this.img.width/this.cols,this.sHeight=this.img.height/this.rows;for(var o=0;o<this.cols;o++){for(var a=[],s=0;s<this.rows;s++){var l=s*this.sHeight,u=o*this.sWidth;a.push(new i(l,u,this.tileIsEmpty(t,n,l,u,this.sWidth)))}this.tileMap.push(a)}}return t.prototype.tileIsEmpty=function(t,e,r,n,i){t.clearRect(0,0,i,i),t.drawImage(e,r,n,i,i,0,0,i,i);for(var o=t.getImageData(0,0,i,i).data,a=Math.floor(Math.floor(o.length/4)),s=0,l=3;l<o.length;l+=4)o[l]>0&&(s+=1);return s<Math.floor(a/10)},t.prototype.isEmpty=function(t,e){return this.tileMap[t][e].isEmpty},t.prototype.getCols=function(){return this.cols},t.prototype.getRows=function(){return this.rows},t.prototype.getTile=function(t,e){return this.tileMap[t][e]},t.prototype.getImage=function(){return this.img},t.prototype.getHeight=function(){return this.sHeight},t.prototype.getWidth=function(){return this.sWidth},t}(),a=function(){function t(){}return t.drawStartAndEnd=function(t,r,n,i,o,a){e.drawColor(t,r,n,i,"rgba(238, 49, 49, 0.5)"),e.drawColor(t,r,o,a,"rgba(0, 122, 204, 0.5)")},t.refresh=function(r,n,i,o,a,s,l,u,d,h){if(r.clearRect(0,0,n.width,n.height),e.drawGrid(r,i,n.width,i*o,a,o),u)for(var f=0;f<s.length;f++)e.drawMapTile(r,d,s[f],i);else e.drawMapTile(r,d,s[l],i);t.drawStartAndEnd(r,i,s[0].getGrid(h.start.x,h.start.y).x,s[0].getGrid(h.start.x,h.start.y).y,s[0].getGrid(h.end.x,h.end.y).x,s[0].getGrid(h.end.x,h.end.y).y)},t.refreshAndShowTile=function(r,n,i,o,a,s,l,u,d,h,f,c,g,p){if(r.clearRect(0,0,n.width,n.height),e.drawGrid(r,i,n.width,i*o,a,o),u)for(var y=0;y<s.length;y++)e.drawMapTile(r,d,s[y],i);else e.drawMapTile(r,d,s[l],i);e.drawTile(r,d,h,f,i,s[l].getGrid(c,g).x,s[l].getGrid(c,g).y),t.drawStartAndEnd(r,i,s[0].getGrid(p.start.x,p.start.y).x,s[0].getGrid(p.start.x,p.start.y).y,s[0].getGrid(p.end.x,p.end.y).x,s[0].getGrid(p.end.x,p.end.y).y),e.drawDark(r,i,s[l].getGrid(c,g).x,s[l].getGrid(c,g).y)},t.refreshAndShowDark=function(r,n,i,o,a,s,l,u,d,h,f,c){if(r.clearRect(0,0,n.width,n.height),e.drawGrid(r,i,n.width,i*o,a,o),u)for(var g=0;g<s.length;g++)e.drawMapTile(r,d,s[g],i);else e.drawMapTile(r,d,s[l],i);t.drawStartAndEnd(r,i,s[0].getGrid(c.start.x,c.start.y).x,s[0].getGrid(c.start.x,c.start.y).y,s[0].getGrid(c.end.x,c.end.y).x,s[0].getGrid(c.end.x,c.end.y).y),e.drawDark(r,i,s[l].getGrid(h,f).x,s[l].getGrid(h,f).y)},t}(),s=function(){function t(){}return t.setStartPosition=function(t,e,r){r.start.x=t,r.start.y=e},t.setEndPosition=function(t,e,r){r.end.x=t,r.end.y=e},t.singleDownBrush=function(t,e,r,n,i,o,a){e.isEmpty(n,i)||(t[r].getGrid(o,a).tileX=n,t[r].getGrid(o,a).tileY=i)},t.areaDownBrush=function(t,e,r,n,i,o,a,s,l){if(!e.isEmpty(n,i)){var u,d,h,f;o>s?(u=o,d=s):(u=s,d=o),a>l?(h=a,f=l):(h=l,f=a);for(var c=d;c<=u;c++)for(var g=f;g<=h;g++)t[r].getGrid(c,g).tileX=n,t[r].getGrid(c,g).tileY=i}},t.fillDownBrush=function(t,e,r,n,i,o,a){if(!n.isEmpty(o,a))for(var s=0;s<t;s++)for(var l=0;l<e;l++)r[i].getGrid(s,l).tileX=o,r[i].getGrid(s,l).tileY=a},t.Erase=function(t,e,r,n){t[e].getGrid(r,n).tileX=null,t[e].getGrid(r,n).tileY=null},t.areaErase=function(t,e,r,n,i,o){var a,s,l,u;r>i?(a=r,s=i):(a=i,s=r),n>o?(l=n,u=o):(l=o,u=n);for(var d=s;d<=a;d++)for(var h=u;h<=l;h++)t[e].getGrid(d,h).tileX=null,t[e].getGrid(d,h).tileY=null},t}(),l=function(){function t(){}return Object.defineProperty(t,"DRAW",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(t,"DRAWAREA",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(t,"FILL",{get:function(){return 2},enumerable:!1,configurable:!0}),Object.defineProperty(t,"ERASE",{get:function(){return 3},enumerable:!1,configurable:!0}),Object.defineProperty(t,"ERASEAREA",{get:function(){return 4},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Start",{get:function(){return 5},enumerable:!1,configurable:!0}),Object.defineProperty(t,"END",{get:function(){return 6},enumerable:!1,configurable:!0}),t.returnToolType=function(e){switch(e){case 0:return t.DRAW;case 1:return t.DRAWAREA;case 2:return t.FILL;case 3:return t.ERASE;case 4:return t.ERASEAREA;case 5:return t.Start;case 6:return t.END;default:return t.DRAW}},t}(),u=function(){function t(){this.arr=[]}return t.prototype.push=function(t){this.arr.push(t)},t.prototype.pop=function(){return this.arr.pop()},t.prototype.top=function(){return this.arr[this.arr.length-1]},t.prototype.size=function(){return this.arr.length},t.prototype.clear=function(){return this.arr=[],!0},t.prototype.toString=function(){return this.arr.toString()},t}(),d=new Array,h=new function(t,e){this.start=t,this.end=e}(new r(0,0,0,0),new r(0,0,0,0));function f(){return h}var c=function(t,e){this.tileX=t,this.tileY=e};var g,p=new function(){this.x=0,this.y=0};function y(){return p}function w(){return g}window.addEventListener("load",(function(){var t=document.getElementById("tileCanvas"),r=new Image;r.onload=function(){t.width=r.width,t.height=r.height;var i=r.width/16,m=t.getContext("2d"),v=new n(i,16,16);g=new o(m,16,16,r),e.drawBackground(m,t.width,t.height),e.drawAllTile(m,g,v,i),t.onmousedown=function(t){var r=v.getGrid(Math.floor(t.offsetY/i),Math.floor(t.offsetX/i));e.drawDark(m,i,r.x,r.y),p.x=Math.floor(t.offsetY/i),p.y=Math.floor(t.offsetX/i)},t.onmouseup=function(){m.clearRect(0,0,t.width,t.height),e.drawBackground(m,t.width,t.height),e.drawAllTile(m,g,v,i)},function(){var t=document.getElementById("canvas"),r=document.getElementById("brushTools"),i=document.getElementById("layer"),o=document.getElementById("showType"),f=document.getElementById("clearCanvas"),c=50,g=15,p=Math.ceil(t.width/c);t.height=p*g;var m=l.DRAW,v=0,E=!0;r.onchange=function(){m=l.returnToolType(r.selectedIndex)},i.onchange=function(){v=i.selectedIndex};for(var x=0;x<i.options.length;x++)d.push(new n(p,c,g));var G,b=t.getContext("2d");e.drawGrid(b,p,t.width,p*g,c,g);var A=!1,R={x:0,y:0},S=new u;o.onclick=function(e){"INPUT"==e.target.tagName&&(E="0"==e.target.value,a.refresh(b,t,p,g,c,d,v,E,w(),h))},f.onclick=function(){S.push({layer:v,map:d[v].getClone()}),d[v].cleanMap(),a.refresh(b,t,p,g,c,d,v,E,w(),h)},document.onkeydown=function(e){if(1==e.ctrlKey&&"z"==e.key&&0!==S.size()){var r=S.pop();d[r.layer].setMap(r.map),a.refresh(b,t,p,g,c,d,v,E,w(),h)}},t.onmousedown=function(e){var r=Math.floor(e.offsetY/p),n=Math.floor(e.offsetX/p);switch(S.push({layer:v,map:d[v].getClone()}),A=!0,R.x=r,R.y=n,m){case l.DRAW:s.singleDownBrush(d,w(),v,y().x,y().y,r,n);break;case l.FILL:s.fillDownBrush(g,c,d,w(),v,y().x,y().y);break;case l.ERASE:s.Erase(d,v,r,n);break;case l.Start:s.setStartPosition(r,n,h);break;case l.END:s.setEndPosition(r,n,h)}m==l.ERASE?a.refreshAndShowDark(b,t,p,g,c,d,v,E,w(),r,n,h):a.refreshAndShowTile(b,t,p,g,c,d,v,E,w(),y().x,y().y,r,n,h)},t.onmouseout=function(){A=!1},t.onmouseup=function(){A=!1},t.onmousemove=function(e){var r=Math.floor(e.offsetY/p),n=Math.floor(e.offsetX/p);if(!(n>49||r>14||r<0||n<0)&&G!=d[v].getGrid(r,n)){if(G=d[v].getGrid(r,n),A)switch(m){case l.DRAW:s.singleDownBrush(d,w(),v,y().x,y().y,r,n);break;case l.DRAWAREA:s.areaDownBrush(d,w(),v,y().x,y().y,R.x,R.y,r,n);break;case l.ERASE:s.Erase(d,v,r,n);break;case l.ERASEAREA:s.areaErase(d,v,R.x,R.y,r,n)}m==l.ERASE?a.refreshAndShowDark(b,t,p,g,c,d,v,E,w(),r,n,h):a.refreshAndShowTile(b,t,p,g,c,d,v,E,w(),y().x,y().y,r,n,h)}}}(),document.getElementById("exportData").onclick=function(){for(var t=d,e=[],r=[new c(0,0)],n=0;n<t.length;n++){for(var i=t[n].getClone(),o=[],a=0;a<i.length;a++){for(var s=[],l=0;l<i[a].length;l++){i[a][l].tileX=null==i[a][l].tileX?0:i[a][l].tileX,i[a][l].tileY=null==i[a][l].tileY?0:i[a][l].tileY;for(var u=0,h=!1,g=0;g<r.length;g++)if(r[g].tileX==i[a][l].tileX&&r[g].tileY==i[a][l].tileY){u=g,h=!0;break}h||(r.push(new c(i[a][l].tileX,i[a][l].tileY)),u=r.length-1,h=!1),s.push(u)}o.push(s)}e.push(o)}var p={start:{x:f().start.x,y:f().start.y},end:{x:f().end.x,y:f().end.y},sprites:r,background:e[0],collision:e[1],traps:e[2],foreground:e[3]};console.log(p);var y=JSON.stringify(p),w=document.createElement("a");w.download="mapData.json",w.style.display="none";var m=new Blob([y]);w.href=URL.createObjectURL(m),document.body.appendChild(w),w.click(),document.body.removeChild(w)}},r.src="./src/img/tiles.png"}),!1)})();